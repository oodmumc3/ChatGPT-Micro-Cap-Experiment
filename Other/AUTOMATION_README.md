# 자동화된 거래 시스템

이 시스템은 LLM API를 통합하여 거래 결정을 자동으로 생성함으로써 ChatGPT 소형주 거래 실험을 자동화합니다.

## 기능

  * **자동 프롬프트 생성**: 현재 포트폴리오 데이터를 포함하여 일일 거래 프롬프트를 생성합니다.
  * **LLM 통합**: OpenAI GPT API를 지원합니다.
  * **거래 실행**: LLM 응답을 구문 분석하고 추천된 거래를 실행합니다.
  * **위험 관리**: 신뢰도 임계값 및 시험 실행(dry-run) 모드를 포함합니다.
  * **로깅**: 모든 LLM 응답 및 거래 결정을 저장합니다.

## 설정

### 1\. 의존성 설치

```bash
pip install -r requirements.txt
pip install openai
```

### 2\. API 키 확보

  * **OpenAI**: [OpenAI Platform](https://platform.openai.com/api-keys)에서 API 키를 받으세요.

### 3\. 환경 변수 설정

```bash
# OpenAI의 경우
export OPENAI_API_KEY="당신의-openai-api-키"
```

## 사용법

`simple_automation.py` 스크립트는 자동화된 거래 결정을 제공합니다.

```bash
# OpenAI를 사용한 기본 사용법
python simple_automation.py --api-key 당신의_OPENAI_키

# 환경 변수 사용
export OPENAI_API_KEY="당신의-키"
python simple_automation.py

# 시험 실행 (실제 거래는 실행되지 않음)
python simple_automation.py --dry-run

# 사용자 지정 모델
python simple_automation.py --model gpt-3.5-turbo
```

## 작동 원리

### 1\. 포트폴리오 분석

  * CSV 파일에서 현재 포트폴리오 상태를 불러옵니다.
  * 현금 잔고 및 총 자산을 계산합니다.
  * LLM 사용을 위해 보유 데이터 형식을 지정합니다.

### 2\. 프롬프트 생성

  * 포트폴리오 데이터를 포함하여 구조화된 프롬프트를 생성합니다.
  * 거래 규칙 및 제약 조건을 포함합니다.
  * JSON 형식의 응답을 요청합니다.

### 3\. LLM 처리

  * 선택한 LLM API에 프롬프트를 전송합니다.
  * 거래 추천을 수신합니다.
  * 거래 세부 정보를 위해 JSON 응답을 구문 분석합니다.

### 4\. 거래 실행

  * 거래 추천을 검증합니다.
  * 현금 가용성 및 포지션 한도를 확인합니다.
  * 승인된 거래를 실행합니다 (또는 시험 실행 모드에서 기록합니다).

## 구성

### LLM 설정

  * **온도(Temperature)**: 0.3 (일관된 결정을 위해 낮은 값 사용)
  * **최대 토큰**: 1500–2000 (모델에 따라 조정)
  * **모델**: 최상의 결과를 위해 GPT-4를 권장합니다.

### 거래 규칙

  * 최대 포지션 규모: 포트폴리오의 10%
  * 최소 신뢰도 임계값: 70%
  * 현금 준비금: 최소 $500
  * 소형주 초점: 시가총액 3억 달러 미만

## 출력 파일

### LLM 응답

  * `llm_responses.jsonl`: 모든 LLM 상호 작용 및 응답
  * `automated_trades.jsonl`: 모든 자동화된 거래 결정

### 포트폴리오 업데이트

  * 원래 거래 스크립트의 기존 CSV 파일을 사용합니다.
  * 수동 거래 시스템과의 호환성을 유지합니다.

## 안전 기능

### 시험 실행 모드 (Dry Run Mode)

어떤 거래가 실행될지 확인하기 위해 항상 `--dry-run`으로 먼저 테스트하세요.

```bash
python simple_automation.py --dry-run
```

### 신뢰도 임계값

시스템에는 품질이 낮은 추천을 방지하기 위한 신뢰도 점수 시스템이 포함되어 있습니다.

### 오류 처리

  * API 실패에 대한 우아한 처리
  * JSON 구문 분석 오류 복구
  * 유효하지 않은 거래 검증

## 기존 시스템과의 통합

자동화 시스템은 기존 수동 거래 시스템과 함께 작동하도록 설계되었습니다.

1.  **동일한 데이터 파일**: 수동 시스템과 동일한 CSV 파일을 사용합니다.
2.  **호환 가능한 형식**: 동일한 포트폴리오 및 거래 기록 형식을 유지합니다.
3.  **대체 지원**: 자동화 모드와 수동 모드 간 전환이 가능합니다.

## 예시 작업 흐름

```bash
# 1. 시험 실행으로 시스템 테스트
python simple_automation.py --dry-run

# 2. 자동화된 거래 실행
python simple_automation.py

# 3. 결과 검토
cat "Start Your Own/llm_responses.jsonl" | tail -1

# 4. 포트폴리오 업데이트 확인
python "Start Your Own/Trading_Script.py"
```

## 문제 해결

### 일반적인 문제

1.  **API 키를 찾을 수 없음**

    ```bash
    export OPENAI_API_KEY="당신의-키"
    ```

2.  **JSON 구문 분석 오류**

      * LLM 응답 형식을 확인하세요.
      * 모델이 구조화된 출력을 지원하는지 확인하세요.
      * 다른 온도 설정을 시도해 보세요.

3.  **거래 실행 실패**

      * 현금 가용성을 확인하세요.
      * 종목 기호가 올바른지 확인하세요.
      * 포지션 규모 제한을 검토하세요.

### 디버그 모드

스크립트를 수정하여 LLM 상호 작용에 대한 자세한 정보를 출력하도록 하여 상세 로깅을 추가하세요.

## 사용자 정의

### 사용자 지정 프롬프트

`generate_trading_prompt()` 함수를 수정하여 LLM에 전송되는 프롬프트를 사용자 지정하세요.

### 다른 모델

다른 모델로 실험해 보세요.

  * `gpt-4`: 최고의 성능, 더 높은 비용
  * `gpt-3.5-turbo`: 좋은 성능, 더 낮은 비용

### 거래 규칙

구성에서 위험 매개변수를 조정하거나 검증 로직을 수정하세요.

## 보안 참고 사항

  * 버전 관리 시스템에 API 키를 커밋하지 마십시오.
  * 민감한 데이터에는 환경 변수를 사용하세요.
  * API 호출에 대한 속도 제한을 고려하세요.
  * API 사용량 및 비용을 모니터링하세요.

## 지원

문제 또는 질문이 있는 경우:

1.  문제 해결 섹션을 확인하세요.
2.  LLM 응답 로그를 검토하세요.
3.  시험 실행 모드로 먼저 테스트하세요.
4.  API 키 권한 및 할당량을 확인하세요.